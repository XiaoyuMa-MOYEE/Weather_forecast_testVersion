æˆ‘è¯¥å¦‚ä½•ä½¿ç”¨APIå¯†é’¥è·å–æ•°æ®
ChatGPT è¯´ï¼š

ä½ å·²ç»æ‹¿åˆ°äº† OpenWeatherMap çš„ API å¯†é’¥ï¼ˆAPI keyï¼‰ï¼Œç°åœ¨åªéœ€è¦æŠŠå®ƒåŠ åˆ°è¯·æ±‚å‚æ•°ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡ Python è®¿é—®å¤©æ°”æ•°æ®äº†ã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼Œè®©ä½ èƒ½ç”¨å¯†é’¥æ­£ç¡®è¯·æ±‚å¹¶è·å–å¤©æ°”é¢„æŠ¥æ•°æ®ã€‚
âœ… ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ä½ çš„ API Key

å‡è®¾ä½ æ‹¿åˆ°çš„ key æ˜¯ï¼š

1234567890abcdef1234567890abcdef

âœ… ç¬¬äºŒæ­¥ï¼šåœ¨ Python ä¸­ä½¿ç”¨è¯¥å¯†é’¥

ä½ éœ€è¦å°†è¿™ä¸ª key åŠ å…¥åˆ° API è¯·æ±‚çš„ appid å‚æ•°ä¸­ã€‚
âœ… ç¤ºä¾‹ä»£ç ï¼ˆè·å– 5 å¤©é¢„æŠ¥ï¼‰

import requests
from collections import defaultdict

def get_weather_forecast(city, api_key):
    url = "https://api.openweathermap.org/data/2.5/forecast"
    params = {
        "q": city,            # åŸå¸‚å
        "appid": api_key,     # ä½ çš„ API Key
        "units": "metric",    # ä½¿ç”¨æ‘„æ°åº¦ï¼ˆ"imperial" è¡¨ç¤ºåæ°åº¦ï¼‰
        "lang": "zh_cn"       # ä¸­æ–‡å¤©æ°”æè¿°
    }

    response = requests.get(url, params=params)
    data = response.json()

    # æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ
    if response.status_code != 200:
        print("è¯·æ±‚å¤±è´¥:", data.get("message", "æœªçŸ¥é”™è¯¯"))
        return

    # æå–æ¯å¤©ä¸­åˆçš„æ•°æ®ï¼ˆ12:00ï¼‰
    forecast_by_day = defaultdict(list)
    for item in data["list"]:
        dt_txt = item["dt_txt"]
        date = dt_txt.split(" ")[0]
        temp = item["main"]["temp"]
        description = item["weather"][0]["description"]
        forecast_by_day[date].append((dt_txt, temp, description))

    print(f"åŸå¸‚ï¼š{data['city']['name']}\n")
    for date, entries in list(forecast_by_day.items())[:5]:  # æœ€å¤šå±•ç¤º5å¤©
        # å–ä¸­åˆ12ç‚¹é‚£ä¸€æ¡ï¼Œæˆ–ç¬¬ä¸€æ¡ä½œä¸ºå¤‡é€‰
        mid = next((e for e in entries if "12:00" in e[0]), entries[0])
        print(f"{date}ï¼š{mid[2]}ï¼Œ{mid[1]}Â°C")

âœ… ä½¿ç”¨æ–¹æ³•ï¼š

api_key = "1234567890abcdef1234567890abcdef"
get_weather_forecast("Beijing", api_key)

âœ… ç¬¬ä¸‰æ­¥ï¼ˆæ¨èï¼‰ï¼šå°† API Key å­˜å‚¨åœ¨ .env æ–‡ä»¶ä¸­ï¼ˆæ›´å®‰å…¨ï¼‰
åˆ›å»º .env æ–‡ä»¶ï¼š

OWM_API_KEY=1234567890abcdef1234567890abcdef

å®‰è£… python-dotenvï¼š

pip install python-dotenv

ä¿®æ”¹ Python ä»£ç ï¼š

import os
from dotenv import load_dotenv

load_dotenv()
api_key = os.getenv("OWM_API_KEY")

ç„¶åç…§å¸¸è°ƒç”¨ get_weather_forecast("Beijing", api_key)
âœ… å¸¸è§é”™è¯¯æ’æŸ¥
é”™è¯¯ä¿¡æ¯	å¯èƒ½åŸå› 
401 Unauthorized	API key é”™è¯¯æˆ–æœªæ¿€æ´»
404 Not Found	åŸå¸‚åæ‹¼å†™é”™è¯¯æˆ–ä¸å­˜åœ¨
429 Too Many Requests	è¯·æ±‚é¢‘ç‡è¶…é™ï¼ˆå…è´¹æ¯åˆ†é’Ÿ 60 æ¬¡ï¼‰
ç½‘ç»œè¯·æ±‚å¤±è´¥	æœ¬åœ°ç½‘ç»œæ•…éšœã€æ‹¼å†™é”™è¯¯ç­‰

å¦‚æœä½ å·²ç»å‡†å¤‡å¥½äº† API keyï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ä½ æƒ³æŸ¥è¯¢å“ªä¸ªåŸå¸‚ï¼Œæˆ‘å¯ä»¥å¸®ä½ æµ‹è¯•ä¸€ä¸‹è¿”å›çš„æ•°æ®æ ¼å¼ã€‚æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ å°è£…ä¸€ä¸ªè¿”å› JSON æˆ–è¡¨æ ¼ç»“æ„çš„ç‰ˆæœ¬ï¼Ÿ
æ‚¨è¯´ï¼š
envæ–‡ä»¶æ˜¯ä»€ä¹ˆ
ChatGPT è¯´ï¼š

å¾ˆå¥½çš„é—®é¢˜ï¼

.env æ–‡ä»¶æ˜¯ä¸€ä¸ª ç”¨äºå­˜å‚¨ç¯å¢ƒå˜é‡ï¼ˆenvironment variablesï¼‰çš„å°æ–‡æœ¬æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š

    API å¯†é’¥ï¼ˆå¦‚ OWM_API_KEY=xxxï¼‰

    æ•°æ®åº“ç”¨æˆ·åå¯†ç 

    é¡¹ç›®é…ç½®å‚æ•°ï¼ˆå¦‚è¿è¡Œæ¨¡å¼ã€è·¯å¾„ï¼‰

âœ… ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ .env æ–‡ä»¶ï¼Ÿ
ä¼˜ç‚¹	è¯´æ˜
å®‰å…¨	é¿å…åœ¨ä»£ç ä¸­ç›´æ¥æš´éœ² API å¯†é’¥
æ–¹ä¾¿ç»´æŠ¤	é…ç½®é›†ä¸­ç®¡ç†ï¼Œä¾¿äºå¤šäººåä½œæˆ–éƒ¨ç½²
å¯åŒºåˆ†ç¯å¢ƒ	æœ¬åœ° / æµ‹è¯• / ç”Ÿäº§å„è‡ªä½¿ç”¨ä¸åŒçš„é…ç½®
é€‚åˆç‰ˆæœ¬æ§åˆ¶	.env æ–‡ä»¶å¯ä¸ä¸Šä¼ åˆ° Gitï¼Œé˜²æ­¢å¯†é’¥æ³„éœ²
ğŸ“ .env æ–‡ä»¶ç¤ºä¾‹

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º .env çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

OWM_API_KEY=1234567890abcdef1234567890abcdef
DB_USER=root
DB_PASS=MySecretPassword

âš ï¸ æ–‡ä»¶åå¿…é¡»æ˜¯ .envï¼Œä¸è¦å¸¦æ‰©å±•åï¼
âœ… å¦‚ä½•åœ¨ Python ä¸­ä½¿ç”¨ .env æ–‡ä»¶

ä½ éœ€è¦ä½¿ç”¨ python-dotenv åº“æ¥è¯»å– .env æ–‡ä»¶ä¸­çš„å˜é‡ã€‚
ğŸ”§ å®‰è£…åº“ï¼š

pip install python-dotenv

ğŸ” ç¤ºä¾‹ä»£ç ï¼š

import os
from dotenv import load_dotenv

# åŠ è½½.envæ–‡ä»¶ä¸­çš„å˜é‡
load_dotenv()

# è·å–æŸä¸ªç¯å¢ƒå˜é‡
api_key = os.getenv("OWM_API_KEY")

print(f"ä½ çš„API Keyæ˜¯ï¼š{api_key}")

ğŸ“ é¡¹ç›®ç»“æ„ç¤ºä¾‹ï¼š

my_weather_project/
â”œâ”€â”€ main.py
â”œâ”€â”€ .env           â† å­˜æ”¾API key
â””â”€â”€ requirements.txt

.env æ–‡ä»¶é»˜è®¤ä¸ä¼šä¸Šä¼ åˆ° GitHubï¼Œåªéœ€åœ¨ .gitignore ä¸­åŠ å…¥ï¼š

.env

âœ… å°ç»“
é—®é¢˜	ç­”æ¡ˆ
.env æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ	ç”¨æ¥ä¿å­˜æ•æ„Ÿæˆ–å¯é…ç½®çš„å‚æ•°ï¼Œæ¯”å¦‚ API å¯†é’¥
æ˜¯å¦å¿…é¡»ç”¨å®ƒï¼Ÿ	éå¿…é¡»ï¼Œä½†æ¨èä½¿ç”¨ï¼Œå°¤å…¶æ˜¯æ¶‰åŠå¯†é’¥æˆ–å¤šç¯å¢ƒéƒ¨ç½²æ—¶
å¦‚ä½•è¯»å–ï¼Ÿ	ç”¨ python-dotenv çš„ load_dotenv() è¯»å–

æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ ï¼š

    åˆ›å»º .env æ–‡ä»¶å¹¶å¡«å…¥ä½ çš„ keyï¼Ÿ

    å†™ä¸€æ®µè¯»å– .env çš„å®Œæ•´ä»£ç æ¨¡æ¿ï¼Ÿ

æ‚¨è¯´ï¼š
envæ–‡ä»¶å¦‚ä½•åœ¨.ipynbæ–‡ä»¶ä¸­ä½¿ç”¨
ChatGPT è¯´ï¼š

å¾ˆå¥½ï¼ä½ å¯ä»¥åœ¨ .ipynb æ–‡ä»¶ï¼ˆJupyter Notebookï¼‰ä¸­å®Œå…¨æ­£å¸¸ä½¿ç”¨ .env æ–‡ä»¶ï¼Œæ–¹æ³•å’Œåœ¨ .py æ–‡ä»¶ä¸­ä¸€æ ·ï¼Œåªéœ€è¦ä¸¤æ­¥ï¼š
âœ… æ­¥éª¤ä¸€ï¼šå®‰è£… python-dotenv

å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…è¿™ä¸ªåº“ï¼Œåœ¨ Notebook çš„ç¬¬ä¸€ä¸ªä»£ç å•å…ƒä¸­è¿è¡Œï¼š

!pip install python-dotenv

âœ… æ­¥éª¤äºŒï¼šåœ¨ Notebook ä¸­åŠ è½½ .env æ–‡ä»¶

åœ¨ä½ é¡¹ç›®ç›®å½•ï¼ˆå³ .ipynb æ‰€åœ¨ç›®å½•ï¼‰ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º .env çš„æ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆä¾‹å¦‚ä½ çš„ API keyï¼‰ï¼š

OWM_API_KEY=1234567890abcdef1234567890abcdef

ç„¶ååœ¨ Notebook ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

import os
from dotenv import load_dotenv

# åŠ è½½ .env æ–‡ä»¶
load_dotenv()

# è·å– API key
api_key = os.getenv("OWM_API_KEY")

print("ä½ çš„API Keyæ˜¯ï¼š", api_key)

âœ… æ•´ä½“ Notebook ç¤ºä¾‹

# Step 1: å®‰è£…ä¾èµ–ï¼ˆåªéœ€ç¬¬ä¸€æ¬¡ï¼‰
!pip install python-dotenv

# Step 2: åŠ è½½ .env å¹¶è¯»å–å˜é‡
import os
from dotenv import load_dotenv

load_dotenv()
api_key = os.getenv("OWM_API_KEY")

# Step 3: ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡Œè¯·æ±‚
import requests

city = "Beijing"
url = "https://api.openweathermap.org/data/2.5/forecast"
params = {
    "q": city,
    "appid": api_key,
    "units": "metric",
    "lang": "zh_cn"
}

response = requests.get(url, params=params)
data = response.json()

# ç®€å•è¾“å‡ºç¬¬ä¸€æ¡ç»“æœ
if response.status_code == 200:
    print(data["list"][0])
else:
    print("è¯·æ±‚å¤±è´¥:", data.get("message", "æœªçŸ¥é”™è¯¯"))

âš ï¸ æ³¨æ„äº‹é¡¹
é—®é¢˜	è¯´æ˜
.env æ–‡ä»¶è·¯å¾„	å¿…é¡»å’Œ .ipynb æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œæˆ–ä¼ ç»å¯¹è·¯å¾„
å˜é‡åæ˜¯å¦å¯ä»¥æœ‰ç©ºæ ¼ï¼Ÿ	âŒ ä¸è¡Œï¼Œåªèƒ½æ˜¯ KEY=VALUE æ ¼å¼
ä¼šä¸ä¼šæš´éœ²å¯†é’¥ï¼Ÿ	åªè¦ä¸ print å‡º api_keyï¼Œä¸ä¼šæš´éœ²

éœ€è¦æˆ‘ä¸ºä½ ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ .env + Notebook é¡¹ç›®æ¨¡æ¿ï¼Ÿæˆ–è€…å¸®ä½ æ·»åŠ é”™è¯¯å¤„ç†ä¸ç¼“å­˜ï¼Ÿ