import ipywidgets as widgets

from IPython.display import display


def run_forecast_ui():
    html_text = widgets.HTML(
        value="<h2 style='color:#66ccff'>æ¬¢è¿ä½¿ç”¨äº¤äº’ç³»ç»Ÿ</h2><p>ä¸€ä¸ªç®€å•çš„é¢„æµ‹ç³»ç»Ÿã€‚</p>"
    )

    city = widgets.Text(
        value = "perth",
        placeholder='è¯·è¾“å…¥åŸå¸‚',
        description='åŸå¸‚åç§°ï¼š',
        disabled=False
    )

    max_day = widgets.Dropdown(
        options=[1, 2, 3, 4, 5],
        value=5,
        description='å¸Œæœ›é¢„æµ‹çš„å¤©æ•°(1-5å¤©)ï¼š',
        layout=widgets.Layout(width='300px'),
        style={'description_width': '150px'}
    )

    question_input = widgets.Text(
        value = "rain",
        placeholder='è¯·è¾“å…¥é—®é¢˜',
        description='æ‚¨æƒ³é—®äº›ä»€ä¹ˆå¤©æ°”é—®é¢˜ï¼š',
        disabled=False,
        layout=widgets.Layout(width='300px'),
        style={'description_width': '150px'}
    )

    predict_button = widgets.Button(
        description='é¢„æµ‹',
        button_style='',
        tooltip='ç‚¹æˆ‘ä¸€ä¸‹',
        icon='check'
    )

    exit_button = widgets.Button(
        description='é€€å‡º',
        button_style='danger',
        tooltip='ç»“æŸç¨‹åº',
        icon='sign-out-alt'
    )

    output = widgets.Output()


    # æŒ‰é’®ç‚¹å‡»å“åº”
    def on_predict_click(b):
        output.clear_output()

        city_name = city.value.strip()
        question = question_input.value.strip()
        day = int(max_day.value)

        city.value = ''
        question_input.value = ''
        max_day.value = 5

        _, _, _, index = validate_inputs(city_name, day, question)

        with output:
            if index == 0:
                print("âŒ è¾“å…¥æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š")
                print(f"åŸå¸‚ï¼š{city_name}")
                print(f"å¤©æ•°ï¼š{day}")
                print(f"é—®é¢˜ï¼š{question}")
            else:
                print("âœ… è¾“å…¥é€šè¿‡ï¼Œå›¾è¡¨å°†åœ¨ä¸‹æ–¹ç”Ÿæˆ")

                try:
                    line_chart(question, city_name, day)
                except Exception as e:
                    print("ğŸš« line_chart æ‰§è¡Œå¤±è´¥ï¼š", e)



    def on_exit_click(b):
        output.clear_output()
        ui_box.close()
        with output:
            print("å·²é€€å‡ºç³»ç»Ÿï¼Œæ„Ÿè°¢ä½¿ç”¨ï¼")

    predict_button.on_click(on_predict_click)
    exit_button.on_click(on_exit_click)

    # åŒ…è£¹å…¨éƒ¨æ§ä»¶ï¼Œä¾¿äºé€€å‡ºæ—¶ç»Ÿä¸€ close()
    ui_box = widgets.VBox([html_text, city, max_day, question_input,
                           widgets.HBox([predict_button, exit_button]),
                           output])
    display(ui_box)

è¿™æ˜¯æˆ‘çš„ç”¨æˆ·äº¤äº’ç•Œé¢ä»£ç ï¼Œæˆ‘åœ¨æ‰§è¡Œä¸»å‡½æ•°çš„æ—¶å€™ï¼š
def main():
    line_chart("rain", "perth", 5)
    run_forecast_ui()


# better way to run the main code
if __name__ == "__main__":
    main()
å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼šå…ˆç”Ÿæˆä¸€ä¸ªå›¾è¡¨ï¼Œç„¶åé€šè¿‡é”®å…¥æ•°æ®ååœ¨uiä¸‹æ–¹ç”Ÿæˆæ–°çš„å›¾è¡¨ï¼Œå¹¶ä¸”é€šè¿‡æ›´æ¢é”®å…¥çš„æ•°æ®å¯ä»¥æ›´æ–°ä¸‹æ–¹çš„å›¾è¡¨ã€‚
ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå½“æˆ‘å°†ä¸»å‡½æ•°ä¸­çš„å‡½æ•°line_chartï¼ˆä¼šç”¨äºuiç”Ÿæˆå›¾è¡¨ï¼‰æ³¨é‡Šæ‰åï¼ˆä¹Ÿå°±æ˜¯è¯´åœ¨è°ƒç”¨uiä¼ å€¼ç”Ÿæˆå›¾è¡¨å‰ä¸ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼‰ï¼ŒUIæ­£å¸¸æ‰§è¡Œï¼Œå¹¶ä¸”å¯¹è¾“å…¥å€¼æœ‰ååº”ï¼Œä½†æ˜¯æ— æ³•æ˜¾ç¤ºå›¾è¡¨ã€‚
ChatGPT è¯´ï¼š

ä½ æ‰€æè¿°çš„é—®é¢˜â€”â€”é¦–æ¬¡è¿è¡Œæœªé¢„ç”Ÿæˆå›¾è¡¨å°±æ— æ³•åœ¨ UI ä¸‹æ–¹ç”Ÿæˆå›¾è¡¨ï¼Œå¾ˆå¯èƒ½æ˜¯ç”±äº Plotly å›¾è¡¨åœ¨ Jupyter Notebook ç¯å¢ƒä¸­ æ¸²æŸ“å™¨æœªåˆå§‹åŒ– æˆ– UI çš„æ˜¾ç¤ºç¯å¢ƒä¸å›¾è¡¨æ¸²æŸ“ç¯å¢ƒæœªç»‘å®š æ‰€è‡´ã€‚
âœ… é—®é¢˜æ€»ç»“ï¼š

    å½“ä½ åœ¨ main() é‡Œå…ˆè°ƒç”¨ line_chart() æ—¶ï¼ŒPlotly åˆå§‹åŒ–äº†æ¸²æŸ“ç¯å¢ƒï¼ˆå¦‚ notebook, notebook_connected ç­‰ï¼‰ï¼Œä»è€Œä¹‹åå³ä½¿åœ¨ ipywidgets.Output() ä¸­å†ç»˜å›¾ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºã€‚

    ä½†æ˜¯å¦‚æœä½ ç›´æ¥è¿›å…¥ UIï¼Œæ²¡æœ‰å…ˆè°ƒç”¨ line_chart()ï¼Œå°±æ²¡æœ‰è§¦å‘ Plotly çš„åˆå§‹åŒ–ï¼Œå›¾è¡¨ä¸ä¼šæ¸²æŸ“å‡ºæ¥ï¼ˆè™½ç„¶é€»è¾‘ã€æ•°æ®éƒ½æ˜¯å¯¹çš„ï¼‰ã€‚

âœ… è§£å†³æ–¹æ³•ï¼ˆæ¨èæ–¹å¼ï¼‰ï¼š

åœ¨æ–‡ä»¶æœ€å¼€å§‹æˆ– run_forecast_ui() ä¸­æ·»åŠ è¿™è¡Œä»£ç ï¼š

import plotly.io as pio
pio.renderers.default = 'notebook_connected'  # æˆ– 'notebook'

è¿™ä¼šç¡®ä¿ Plotly å›¾è¡¨åœ¨ Jupyter ç¯å¢ƒä¸‹è‡ªåŠ¨ç»‘å®šåˆ° Notebook æ¸²æŸ“å™¨ï¼Œæ— éœ€æå‰ç»˜åˆ¶å›¾è¡¨æ¥è§¦å‘åˆå§‹åŒ–ã€‚
âœ… è¡¥å……å»ºè®®ï¼šç¡®è®¤ line_chart() ä¸­æ˜¯å¦ä½¿ç”¨ fig.show()ï¼Ÿ

ç¡®ä¿ä½ åœ¨ line_chart() ä¸­æ˜¯ä»¥å¦‚ä¸‹æ–¹å¼è°ƒç”¨çš„ï¼š

def line_chart(question, city, day):
    ...
    fig.show()

å¦åˆ™å›¾è¡¨å³ä½¿åˆ›å»ºäº†ï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºã€‚
âœ… ç¤ºä¾‹ä¿®å¤æ–¹æ¡ˆæ•´åˆï¼š

import plotly.io as pio
pio.renderers.default = 'notebook_connected'  # ç¡®ä¿ Plotly æ¸²æŸ“å™¨åˆå§‹åŒ–

æ”¾åœ¨ä½ çš„æ–‡ä»¶é¡¶éƒ¨æˆ– run_forecast_ui() å¼€å§‹å¤„å³å¯ã€‚
âœ… æµ‹è¯•æµç¨‹å»ºè®®ï¼š

    æ³¨é‡Šæ‰ main() ä¸­çš„ line_chart(...)

    æ·»åŠ  pio.renderers.default = 'notebook_connected'

    è¿è¡Œ UI ç•Œé¢ï¼Œå°è¯•è¾“å…¥æ–°åŸå¸‚ã€é—®é¢˜ï¼Œç‚¹å‡»â€œé¢„æµ‹â€

    å›¾è¡¨åº”åœ¨ Output() åŒºåŸŸä¸­æ­£å¸¸ç”Ÿæˆ

å¦‚ä½ ä»é‡åˆ°é—®é¢˜ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ æ£€æŸ¥ line_chart() å‡½æ•°çš„å®ç°æ˜¯å¦æ­£ç¡®ç»‘å®šåˆ°äº†è¾“å‡ºåŒºåŸŸã€‚ä½ å¯ä»¥è´´å‡ºå®ƒçš„å®Œæ•´å®šä¹‰ä¾›æˆ‘åˆ†æã€‚
æ‚¨è¯´ï¼š
from datetime import datetime
import plotly.graph_objects as go
from IPython.display import display


def line_chart(questions, city, max_day):
    # print("è¿›å…¥äº†å‡½æ•°")
    data, index, answer = get_line_chart_data(questions, city, max_day)  #è·å–æ•°æ®
    if index == 0:  #æ²¡æœ‰è¿”å›æ•°æ®ï¼Œä»…è¾“å‡º
        print("\n".join(data))
    else:
        print("1")
        title_of_image = "null"
        description= "null"
        if answer == "pop":
            title_of_image = "Rainfall prediction chart"
            description = "ä¸‹é›¨"
        elif answer == "describe":
            title_of_image = "Weather description map"
            description = "å¤©æ°”"
        elif answer == "cloth" or "temperature":
            title_of_image = "Temperature prediction chart"
            description = "æ¸©åº¦"
        elif answer == "wind":
            title_of_image = "Wind speed prediction graph"
            description = "é£é€Ÿ"
        elif answer == "humidity":
            title_of_image = "Humidity prediction chart"
            description = "æ¹¿åº¦"
        print(f"æ‚¨è¯¢é—®çš„é—®é¢˜ä¸{description}ç›¸å…³æ­£åœ¨ç”ŸæˆæŠ˜çº¿å›¾")
        times = [datetime.strptime(item[0], "%Y-%m-%d %H:%M:%S") for item in data]
        values = [item[1] for item in data]

        # ä½¿ç”¨ Plotly åˆ›å»ºäº¤äº’å¼å›¾è¡¨
        fig = go.Figure()

        # æ·»åŠ æ•°æ®åˆ°å›¾è¡¨
        fig.add_trace(go.Scatter(x=times, y=values, mode='lines+markers', name='Precipitation Probability'))

        # æ›´æ–°å¸ƒå±€
        fig.update_layout(
            title=title_of_image,
            xaxis_title="Date and Time",
            yaxis_title={
                "pop": "Precipitation Probability",
                "describe": "Weather Condition Code",
                "cloth": "Temperature (Â°C)",
                "temperature": "Temperature (Â°C)",
                "wind": "Wind Speed (km/h)",
                "humidity": "Humidity (%)"
            }.get(answer, "Value"),
            xaxis=dict(tickformat="%Y-%m-%d %H:%M:%S", tickangle=45),
            autosize=True
        )

        # æ˜¾ç¤ºå›¾è¡¨
        display(fig)
è¿™ä¸ªæ˜¯æ˜¯line chart ä»£ç 
ChatGPT è¯´ï¼š

æ„Ÿè°¢æä¾›å®Œæ•´ä»£ç ï¼Œä½ çš„ line_chart() å‡½æ•°ç»“æ„åŸºæœ¬æ­£ç¡®ï¼Œä½†é—®é¢˜ç¡®å®å‡ºåœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š
âœ…ã€æ ¸å¿ƒé—®é¢˜å®šä½ã€‘å›¾è¡¨æœªæ˜¾ç¤ºçš„ä¸¤ä¸ªå…³é”®åŸå› ï¼š
â‘  Plotly å›¾è¡¨æœªè°ƒç”¨ .show() æˆ–æœªç»‘å®š notebook æ¸²æŸ“å™¨

è™½ç„¶ä½ ç”¨äº† display(fig)ï¼Œè¿™åœ¨æŸäº› Jupyter Notebook ç¯å¢ƒä¸­å¯ä»¥å·¥ä½œï¼Œä½†åœ¨ ipywidgets.Output() å®¹å™¨ä¸‹ï¼Œè¿™å¹¶ä¸å¯é ã€‚æ¨èä½¿ç”¨ï¼š

fig.show()

æ›¿æ¢ display(fig)ï¼Œè¿™æ ·æ— è®ºæ˜¯åœ¨ UI è¾“å‡ºåŒºè¿˜æ˜¯åœ¨ Notebook ä¸­ï¼ŒPlotly éƒ½èƒ½ç¡®ä¿æ­£ç¡®æ¸²æŸ“ã€‚
â‘¡ åˆ¤æ–­è¯­å¥é€»è¾‘é”™è¯¯

ä½ å†™äº†ï¼š

elif answer == "cloth" or "temperature":

è¿™å®é™…ä¸Šç­‰ä»·äºï¼š

elif (answer == "cloth") or True:

å› ä¸º "temperature" æ˜¯éç©ºå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼æ°¸è¿œä¸º Trueï¼Œå¯¼è‡´è¿™ä¸ªåˆ†æ”¯æ°¸è¿œæˆç«‹ã€‚

åº”è¯¥æ”¹ä¸ºï¼š

elif answer in ["cloth", "temperature"]:

âœ…ã€ä¿®å¤å»ºè®®ã€‘ä¿®æ”¹åçš„ line_chart() å‡½æ•°å¦‚ä¸‹ï¼š

from datetime import datetime
import plotly.graph_objects as go

def line_chart(questions, city, max_day):
    data, index, answer = get_line_chart_data(questions, city, max_day)
    if index == 0:
        print("\n".join(data))
    else:
        title_of_image = "null"
        description = "null"
        if answer == "pop":
            title_of_image = "Rainfall prediction chart"
            description = "ä¸‹é›¨"
        elif answer == "describe":
            title_of_image = "Weather description map"
            description = "å¤©æ°”"
        elif answer in ["cloth", "temperature"]:
            title_of_image = "Temperature prediction chart"
            description = "æ¸©åº¦"
        elif answer == "wind":
            title_of_image = "Wind speed prediction graph"
            description = "é£é€Ÿ"
        elif answer == "humidity":
            title_of_image = "Humidity prediction chart"
            description = "æ¹¿åº¦"

        print(f"æ‚¨è¯¢é—®çš„é—®é¢˜ä¸{description}ç›¸å…³ï¼Œæ­£åœ¨ç”ŸæˆæŠ˜çº¿å›¾")

        times = [datetime.strptime(item[0], "%Y-%m-%d %H:%M:%S") for item in data]
        values = [item[1] for item in data]

        fig = go.Figure()
        fig.add_trace(go.Scatter(x=times, y=values, mode='lines+markers', name='Value'))

        fig.update_layout(
            title=title_of_image,
            xaxis_title="Date and Time",
            yaxis_title={
                "pop": "Precipitation Probability",
                "describe": "Weather Condition Code",
                "cloth": "Temperature (Â°C)",
                "temperature": "Temperature (Â°C)",
                "wind": "Wind Speed (km/h)",
                "humidity": "Humidity (%)"
            }.get(answer, "Value"),
            xaxis=dict(tickformat="%Y-%m-%d %H:%M:%S", tickangle=45),
            autosize=True
        )

        fig.show()  # æ ¸å¿ƒä¿®å¤ç‚¹

âœ…ã€å…¨å±€å»ºè®®ã€‘åœ¨æœ€é¡¶å±‚åŠ ä¸Šï¼š

import plotly.io as pio
pio.renderers.default = 'notebook_connected'

å¯é˜²æ­¢åœ¨ Jupyter + ipywidgets æ··ç”¨æ—¶å›¾è¡¨ä¸æ˜¾ç¤ºçš„é—®é¢˜ã€‚
âœ…ã€æµ‹è¯•å»ºè®®ã€‘æœ€ç»ˆæ‰§è¡Œé¡ºåºï¼š

# æ— éœ€å…ˆæ‰§è¡Œ line_chart
run_forecast_ui()

ç„¶åç›´æ¥ä» UI è¾“å…¥å†…å®¹ â†’ ç‚¹å‡»â€œé¢„æµ‹â€ â†’ å›¾è¡¨åº”æ­£å¸¸æ˜¾ç¤ºã€‚

å¦‚ä½ ä»æ— æ³•æ˜¾ç¤ºå›¾è¡¨ï¼Œè¯·å‘Šè¯‰æˆ‘ä½ ä½¿ç”¨çš„æ˜¯å“ªç§ç¯å¢ƒï¼ˆå¦‚ Jupyter Notebook / JupyterLab / Google Colab / IntelliJ with IPython pluginï¼‰ï¼Œæˆ‘ä¼šæä¾›å¯¹åº”å¹³å°çš„ä¸“å±ä¿®å¤å»ºè®®ã€‚
æ‚¨è¯´ï¼š
æ›´æ–°ä¹‹åï¼Œå³ä½¿æˆ‘æ²¡æœ‰æ³¨é‡Šæ‰lineå‡½æ•°ï¼Œä¹Ÿä»ä¸æ˜¾ç¤ºå›¾è¡¨ï¼Œä½†æ˜¯åŸå…ˆæ˜¾ç¤ºå›¾è¡¨çš„ä½ç½®ä»ç„¶è¢«å æ®ï¼Œåªæ˜¯æ²¡æœ‰æ˜¾ç¤º
ChatGPT è¯´ï¼š

ä½ çš„æè¿°â€”â€”â€œå›¾è¡¨ä½ç½®ä»è¢«å æ®ï¼Œä½†æ²¡æœ‰æ˜¾ç¤ºå›¾è¡¨â€â€”â€”è¯´æ˜å›¾è¡¨å¯¹è±¡å®é™…ä¸Šè¢«â€œåˆ›å»ºâ€äº†ï¼Œä½†æ²¡æœ‰æˆåŠŸæ¸²æŸ“åˆ° Notebook è¾“å‡ºåŒºåŸŸã€‚ç»“åˆä½ ä¹‹å‰æåˆ°ï¼š

    ä½¿ç”¨çš„æ˜¯ IntelliJ IDEA

    å›¾è¡¨åˆæ¬¡æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä¸å†æ˜¾ç¤º

è¿™å¾ˆå¯èƒ½æ˜¯ç”±ä»¥ä¸‹åŸå› é€ æˆçš„ï¼š
âœ… æ ¹æœ¬åŸå› æ’æŸ¥æ¸…å•ï¼ˆå¸¦è§£å†³æ–¹æ³•ï¼‰
ğŸ”¹ 1. Plotly æ¸²æŸ“å™¨ä¸å…¼å®¹ IDEA çš„ Jupyter æ’ä»¶

IntelliJ IDEA ä¸­çš„ Jupyter Notebook æ’ä»¶å¹¶ä¸å®Œå…¨æ”¯æŒ Plotly çš„ notebook_connected æˆ– notebook æ¸²æŸ“æ–¹å¼ã€‚
âœ… è§£å†³æ–¹æ¡ˆï¼š

åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå¼ºåˆ¶ä½¿ç”¨ iframe æ¸²æŸ“å™¨ï¼ˆæœ€ç¨³å®šã€é€šç”¨çš„æ¸²æŸ“æ–¹å¼ï¼‰ï¼š

import plotly.io as pio
pio.renderers.default = 'iframe_connected'

æˆ–è€…ï¼š

pio.renderers.default = 'iframe'  # å¦‚æœä½ ä¸å¸Œæœ›å®ƒè”ç½‘åŠ è½½èµ„æº

è¿™å°†è®© fig.show() åœ¨ä»»ä½• IDE æˆ– HTML æ¸²æŸ“ä¸­éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºã€‚
ğŸ”¹ 2. ä½ çš„ UI è¾“å‡ºåŒºåŸŸæ˜¯ ipywidgets.Output()ï¼Œå¯èƒ½å¯¹ Plotly çš„ notebook æ¸²æŸ“å™¨å…¼å®¹æ€§å·®

ipywidgets.Output() å’Œ fig.show() å¹¶ä¸æ€»æ˜¯å®Œç¾é…åˆï¼Œç‰¹åˆ«åœ¨é Jupyter Lab / æ ‡å‡† Notebook ç¯å¢ƒä¸­ã€‚
âœ… æ›¿ä»£æ–¹æ³•ï¼šä½¿ç”¨ display(fig.to_html(...)) æ¸²æŸ“ HTML

ä¿®æ”¹ line_chart() çš„æ˜¾ç¤ºéƒ¨åˆ†å¦‚ä¸‹ï¼š

from IPython.display import HTML

...

html = fig.to_html(include_plotlyjs='cdn', full_html=False)
display(HTML(html))

è¿™å°†æ‰‹åŠ¨æŠŠå›¾è¡¨è½¬æˆ HTML å¹¶æ¸²æŸ“â€”â€”å³ä½¿æ˜¯ Output åŒºåŸŸä¹Ÿå¯ä»¥å·¥ä½œè‰¯å¥½ã€‚
ğŸ”¹ 3. å›¾è¡¨æ•°æ®ç”Ÿæˆå¤±è´¥ä½†æœªæŠ¥é”™

ä½ è¯´â€œä½ç½®è¢«å æ®ä½†å›¾æ²¡æ˜¾ç¤ºâ€ï¼Œä¹Ÿå¯èƒ½æ•°æ®ä¸ºç©ºä½†æœªè§¦å‘å¼‚å¸¸ã€‚
âœ… æ£€æŸ¥ data æ˜¯å¦ä¸ºç©ºï¼š

åœ¨ line_chart() é‡ŒåŠ å…¥ï¼š

if not data:
    print("âš ï¸ æ²¡æœ‰è·å–åˆ°æ•°æ®ï¼Œå›¾è¡¨æ— æ³•ç”Ÿæˆ")
    return

âœ… æ¨èæœ€ç»ˆå†™æ³•ï¼ˆç¨³å¥ï¼‰

åœ¨ line_chart() çš„æ˜¾ç¤ºéƒ¨åˆ†æ”¹ä¸ºå¦‚ä¸‹ä»£ç ï¼Œé€‚é…æ‰€æœ‰ç¯å¢ƒï¼š

from IPython.display import HTML

...

if not data:
    print("âš ï¸ æ²¡æœ‰è·å–åˆ°æ•°æ®ï¼Œå›¾è¡¨æ— æ³•ç”Ÿæˆ")
    return

...

# ä½¿ç”¨æ›´ç¨³å®šçš„ HTML æ¸²æŸ“æ–¹å¼
html = fig.to_html(include_plotlyjs='cdn', full_html=False)
display(HTML(html))

åŒæ—¶åœ¨é¡¶éƒ¨åŠ ä¸Šï¼š

import plotly.io as pio
pio.renderers.default = 'iframe_connected'

ğŸ” è¡¥å……å»ºè®®ï¼šä½ å¯ä»¥è¯•è¯•çœ‹å›¾è¡¨æ˜¯å¦èƒ½åœ¨ æ ‡å‡† Jupyter Notebookï¼ˆjupyter notebook å¯åŠ¨çš„ç½‘é¡µï¼‰ä¸­æ˜¾ç¤ºã€‚å¦‚æœå¯ä»¥è¯´æ˜æ˜¯ IntelliJ çš„å…¼å®¹é—®é¢˜ã€‚

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ æŠŠ line_chart() ä¸­æ˜¾ç¤ºéƒ¨åˆ†æå–æˆä¸€ä¸ªç‹¬ç«‹æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

def render_chart(fig):
    from IPython.display import HTML
    html = fig.to_html(include_plotlyjs='cdn', full_html=False)
    display(HTML(html))

ç„¶åä½ åœ¨ line_chart() é‡Œè°ƒç”¨ render_chart(fig) å³å¯ã€‚

éœ€è¦æˆ‘å¸®ä½ æ•´ç†æˆå®Œæ•´å¯è¿è¡Œçš„ä¿®å¤ç‰ˆä»£ç å—ï¼Ÿ
æ‚¨è¯´ï¼š
æ›´æ–°ä¹‹åé—®é¢˜ä¾æ—§ï¼Œä¸æ³¨é‡Šæ‰å¯ä»¥æ˜¾ç¤ºï¼Œæ³¨é‡Šåæ— æ˜¾ç¤º
ChatGPT è¯´ï¼š

éå¸¸æ„Ÿè°¢ä½ çš„è€å¿ƒåé¦ˆã€‚ä½ æè¿°çš„ç°è±¡éå¸¸å…³é”®ï¼š

    âœ… ä¸æ³¨é‡Š line_chart() åœ¨ä¸»å‡½æ•°ä¸­å¯ä»¥æ˜¾ç¤ºå›¾è¡¨
    âŒ æ³¨é‡Šåå›¾è¡¨å®Œå…¨ä¸æ˜¾ç¤ºï¼Œä½†ä½ç½®ä»è¢«å æ®

è¿™è¯´æ˜å›¾è¡¨èƒ½å¦æ˜¾ç¤ºå¹¶ä¸æ˜¯æ•°æ®æˆ–é€»è¾‘çš„é—®é¢˜ï¼Œè€Œæ˜¯åœ¨é¦–æ¬¡è¿è¡Œæ—¶æœªæ­£ç¡®åˆå§‹åŒ– Plotly çš„æ¸²æŸ“ç¯å¢ƒï¼Œå°¤å…¶æ˜¯åœ¨ ipywidgets çš„ Output() å®¹å™¨ä¸­è¿›è¡ŒåŠ¨æ€ç»˜å›¾ æ—¶ã€‚
âœ… å½»åº•ä¿®å¤æ–¹æ¡ˆï¼šæ‰‹åŠ¨æ¿€æ´»æ¸²æŸ“å™¨ + å¼ºåˆ¶åµŒå…¥ HTML å›¾è¡¨

æˆ‘ä»¬æ¥ç»„åˆå‡ºä¸€ä¸ªå½»åº•ä¿®å¤æ–¹æ¡ˆï¼Œé€‚é…ä»»æ„ UI äº¤äº’ç¯å¢ƒï¼ˆåŒ…æ‹¬ IntelliJï¼‰ï¼š
âœ… ç¬¬ä¸€æ­¥ï¼šå¼ºåˆ¶ Plotly ä½¿ç”¨ HTML æ¸²æŸ“æ–¹å¼

æ›¿æ¢ line_chart() æœ€åçš„ fig.show() éƒ¨åˆ†ï¼š

from IPython.display import HTML

def render_chart(fig):
    html = fig.to_html(include_plotlyjs='cdn', full_html=False)
    display(HTML(html))

ç„¶ååœ¨ line_chart() ä¸­ç”¨ï¼š

render_chart(fig)

âœ… ç¬¬äºŒæ­¥ï¼šUI åˆå§‹åŒ–æ—¶å¼ºåˆ¶å¼•å¯¼æ¸²æŸ“å™¨æ¿€æ´»ä¸€æ¬¡ï¼ˆå…³é”®ï¼‰

ä½ å¿…é¡»åœ¨ UI åˆå§‹åŒ–å‰ï¼Œè°ƒç”¨ä¸€æ¬¡ç©ºå›¾åˆå§‹åŒ–ï¼Œè®© Plotly æ¸²æŸ“å™¨å®Œæˆæ³¨å†Œã€‚
âœ” æ·»åŠ è¿™ä¸ªå‡½æ•°ï¼ˆåªåˆå§‹åŒ–ä¸€æ¬¡ç©ºå›¾ï¼‰ï¼š

def initialize_plotly_renderer():
    import plotly.graph_objects as go
    from IPython.display import HTML
    fig = go.Figure()
    fig.add_trace(go.Scatter(x=[0], y=[0]))
    html = fig.to_html(include_plotlyjs='cdn', full_html=False)
    display(HTML(html))

ç„¶ååœ¨ä¸»å‡½æ•°ä¸­è¿™æ ·å†™ï¼š

def main():
    initialize_plotly_renderer()  # ğŸŸ© å¼ºåˆ¶é¢„åŠ è½½å›¾è¡¨æ¸²æŸ“å™¨
    run_forecast_ui()

âœ… ç¬¬ä¸‰æ­¥ï¼šç¡®ä¿é¡¶éƒ¨åŠ ä¸Šæ¸²æŸ“å™¨è®¾ç½®ï¼ˆå¯é€‰ä½†æ¨èï¼‰

import plotly.io as pio
pio.renderers.default = 'iframe_connected'

ğŸ” ä¿®å¤åçš„å…³é”®æµç¨‹

1. main():
    - initialize_plotly_renderer() âœ…ã€è§£å†³é¦–æ¬¡æ¸²æŸ“å™¨æœªåˆå§‹åŒ–ã€‘
    - run_forecast_ui()

2. ç”¨æˆ·ç‚¹å‡»â€œé¢„æµ‹â€ï¼š
    - åœ¨ output åŒºåŸŸåŠ¨æ€ç»˜å›¾
    - ä½¿ç”¨ HTML æ¸²æŸ“å›¾è¡¨ï¼Œé€‚é…æ‰€æœ‰ç¯å¢ƒ

3. æ— éœ€é¢„è°ƒç”¨ line_chart()ï¼Œå›¾è¡¨å§‹ç»ˆæ˜¾ç¤º

âœ… å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ æ‰“åŒ…æˆå®Œæ•´ä»£ç ç»“æ„ï¼Œä¹Ÿå¯ä»¥å‘å‡ºä½ çš„ get_line_chart_data() çš„æ ·å­ï¼Œæˆ‘å¯å¸®ä½ æ¥å¥½æ‰€æœ‰æ¥å£ã€‚

å¦‚ä»å¤±è´¥ï¼Œè¯·å‘Šè¯‰æˆ‘ä½ å½“å‰è¿è¡Œçš„å®Œæ•´ç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼š

    IntelliJ IDEA + Jupyter æ’ä»¶ï¼Ÿè¿˜æ˜¯ Jupyter Notebookï¼Ÿ

    æ˜¯å¦ä½¿ç”¨ Anaconda æˆ–è™šæ‹Ÿç¯å¢ƒï¼Ÿ

    æ˜¯å¦ä½¿ç”¨ .ipynb æ–‡ä»¶è¿˜æ˜¯ .py æ–‡ä»¶æ‰§è¡Œï¼Ÿ

æˆ‘ä¼šé’ˆå¯¹ä½ çš„å¹³å°ç›´æ¥ä¼˜åŒ–ã€‚